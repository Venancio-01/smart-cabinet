{"version":3,"sources":["../../../../src/main/database/methods/document.ts"],"sourcesContent":["import type { rfid_switch_record } from '@prisma/client'\nimport prisma from '@/database'\n\n/**\n * @description: 根据柜门 id 获取柜内文件总数\n * @return {*}\n */\nexport async function queryDocumentCountByCabinetId(cabinetId = 1) {\n  const count = await prisma.doc_document.count({\n    where: {\n      cabinet_door_id: cabinetId,\n    },\n  })\n\n  return count\n}\n\n/**\n * @description: 获取柜内在位文件数\n * @param {*} cabinetId 柜门 id\n * @return {*}\n */\nexport async function queryInPlaceDocumentCount(cabinetId?: number) {\n  const where = {\n    loan_status: 0,\n  }\n\n  if (cabinetId)\n    where.cabinet_door_id = cabinetId\n\n  const count = await prisma.doc_document.count({\n    where,\n  })\n\n  return count\n}\n\n/**\n * @description: 获取错放文件信息\n * @return {*}\n */\nexport async function queryMisplacedDocument(cabinetDoorID?: number) {\n  const result = await prisma.rfid_switch_record.findMany({\n    where: {\n      operation_id: {\n        not: '0',\n      },\n      cabinet_door_id: cabinetDoorID || undefined,\n    },\n  })\n\n  return result\n}\n\n/**\n * @description: 根据 tid 获取错放文件数量\n * @param {number} tid\n * @return {*}\n */\nexport async function queryMisplacedDocumentCount(cabinetDoorId?: number, rfid?: string) {\n  const count = await prisma.rfid_switch_record.count({\n    where: {\n      operation_id: rfid || undefined,\n      cabinet_door_id: cabinetDoorId || undefined,\n    },\n  })\n\n  return count\n}\n\n/**\n * @description: 根据文件 id 修改状态\n * @param {number} id\n * @param {number} state\n * @return {*}\n */\nexport async function updateDocStatusByID(id: number, state: number, userId: number) {\n  const result = await prisma.doc_document.updateMany({\n    where: {\n      doc_id: id,\n    },\n    data: {\n      operation_user_id: userId,\n      loan_status: state,\n      doc_last_time: new Date(),\n    },\n  })\n\n  return result\n}\n\n/**\n * @description: 添加错放文件记录\n * @param {any} document\n * @return {*}\n */\nexport async function addMisPlacedDocument(document: Partial<rfid_switch_record>) {\n  const result = await prisma.rfid_switch_record.create({\n    data: document,\n  })\n\n  return result\n}\n\n/**\n * @description: 更新错放文件记录\n * @param {string} tid\n * @return {*}\n */\nexport async function updateMisPlaceDocument(id: string) {\n  const result = await prisma.rfid_switch_record.updateMany({\n    where: {\n      operation_id: id,\n    },\n    data: {\n      operation_id: '0',\n    },\n  })\n\n  return result\n}\n\nexport async function queryMisplacedDocumentCountByOperationId(id: string) {\n  const result = await prisma.rfid_switch_record.findMany({\n    where: {\n      operation_id: id,\n    },\n  })\n\n  return result?.length\n}\n"],"names":["queryDocumentCountByCabinetId","queryInPlaceDocumentCount","queryMisplacedDocument","queryMisplacedDocumentCount","updateDocStatusByID","addMisPlacedDocument","updateMisPlaceDocument","queryMisplacedDocumentCountByOperationId","cabinetId","count","prisma","doc_document","where","cabinet_door_id","loan_status","cabinetDoorID","result","rfid_switch_record","findMany","operation_id","not","undefined","cabinetDoorId","rfid","id","state","userId","updateMany","doc_id","data","operation_user_id","doc_last_time","Date","document","create","length"],"mappings":"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"}