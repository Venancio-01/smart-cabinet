{"version":3,"sources":["../../../../src/main/database/methods/document.ts"],"sourcesContent":["import prisma from '@/database'\nimport { rfid_switch_record } from '@prisma/client'\n\n/**\n * @description: 根据柜门 id 获取柜内文件总数\n * @return {*}\n */\nexport const queryDocumentCountByCabinetId = async (cabinetId = 1) => {\n  const count = await prisma.doc_document.count({\n    where: {\n      cabinet_door_id: cabinetId\n    }\n  })\n\n  return count\n}\n\n/**\n * @description: 获取柜内在位文件数\n * @param {*} cabinetId 柜门 id\n * @return {*}\n */\nexport const queryInPlaceDocumentCount = async (cabinetId?: number) => {\n  const where = {\n    loan_status: 0\n  }\n\n  if (cabinetId) {\n    where['cabinet_door_id'] = cabinetId\n  }\n\n  const count = await prisma.doc_document.count({\n    where\n  })\n\n  return count\n}\n\n/**\n * @description: 获取错放文件信息\n * @return {*}\n */\nexport const queryMisplacedDocument = async (cabinetDoorID?: number) => {\n  const result = await prisma.rfid_switch_record.findMany({\n    where: {\n      operation_id: {\n        not: '0'\n      },\n      cabinet_door_id: cabinetDoorID || undefined\n    }\n  })\n\n  return result\n}\n\n/**\n * @description: 根据 tid 获取错放文件数量\n * @param {number} tid\n * @return {*}\n */\nexport const queryMisplacedDocumentCount = async (cabinetDoorId?: number, rfid?: string) => {\n  const count = await prisma.rfid_switch_record.count({\n    where: {\n      operation_id: rfid || undefined,\n      cabinet_door_id: cabinetDoorId || undefined\n    }\n  })\n\n  return count\n}\n\n/**\n * @description: 根据文件 id 修改状态\n * @param {number} id\n * @param {number} state\n * @return {*}\n */\nexport const updateDocStatusByID = async (id: number, state: number, userId: number) => {\n  const result = await prisma.doc_document.updateMany({\n    where: {\n      doc_id: id\n    },\n    data: {\n      operation_user_id: userId,\n      loan_status: state,\n      doc_last_time: new Date()\n    }\n  })\n\n  return result\n}\n\n/**\n * @description: 添加错放文件记录\n * @param {any} document\n * @return {*}\n */\nexport const addMisPlacedDocument = async (document: Partial<rfid_switch_record>) => {\n  const result = await prisma.rfid_switch_record.create({\n    data: document\n  })\n\n  return result\n}\n\n/**\n * @description: 更新错放文件记录\n * @param {string} tid\n * @return {*}\n */\nexport const updateMisPlaceDocument = async (id: string) => {\n  const result = await prisma.rfid_switch_record.updateMany({\n    where: {\n      operation_id: id\n    },\n    data: {\n      operation_id: '0'\n    }\n  })\n\n  return result\n}\n\nexport const queryMisplacedDocumentCountByOperationId = async (id: string) => {\n  const result = await prisma.rfid_switch_record.findMany({\n    where: {\n      operation_id: id\n    }\n  })\n\n  return result?.length\n}\n"],"names":["queryDocumentCountByCabinetId","queryInPlaceDocumentCount","queryMisplacedDocument","queryMisplacedDocumentCount","updateDocStatusByID","addMisPlacedDocument","updateMisPlaceDocument","queryMisplacedDocumentCountByOperationId","cabinetId","count","prisma","doc_document","where","cabinet_door_id","loan_status","cabinetDoorID","result","rfid_switch_record","findMany","operation_id","not","undefined","cabinetDoorId","rfid","id","state","userId","updateMany","doc_id","data","operation_user_id","doc_last_time","Date","document","create","length"],"mappings":";;;;;;;;;;;IAOaA,6BAA6B;eAA7BA;;IAeAC,yBAAyB;eAAzBA;;IAoBAC,sBAAsB;eAAtBA;;IAkBAC,2BAA2B;eAA3BA;;IAiBAC,mBAAmB;eAAnBA;;IAoBAC,oBAAoB;eAApBA;;IAaAC,sBAAsB;eAAtBA;;IAaAC,wCAAwC;eAAxCA;;;iEA3HM;;;;;;AAOZ,MAAMP,gCAAgC,OAAOQ,YAAY,CAAC;IAC/D,MAAMC,QAAQ,MAAMC,kBAAOC,aAAaF,MAAM;QAC5CG,OAAO;YACLC,iBAAiBL;QACnB;IACF;IAEA,OAAOC;AACT;AAOO,MAAMR,4BAA4B,OAAOO;IAC9C,MAAMI,QAAQ;QACZE,aAAa;IACf;IAEA,IAAIN,WAAW;QACbI,KAAK,CAAC,kBAAkB,GAAGJ;IAC7B;IAEA,MAAMC,QAAQ,MAAMC,kBAAOC,aAAaF,MAAM;QAC5CG;IACF;IAEA,OAAOH;AACT;AAMO,MAAMP,yBAAyB,OAAOa;IAC3C,MAAMC,SAAS,MAAMN,kBAAOO,mBAAmBC,SAAS;QACtDN,OAAO;YACLO,cAAc;gBACZC,KAAK;YACP;YACAP,iBAAiBE,iBAAiBM;QACpC;IACF;IAEA,OAAOL;AACT;AAOO,MAAMb,8BAA8B,OAAOmB,eAAwBC;IACxE,MAAMd,QAAQ,MAAMC,kBAAOO,mBAAmBR,MAAM;QAClDG,OAAO;YACLO,cAAcI,QAAQF;YACtBR,iBAAiBS,iBAAiBD;QACpC;IACF;IAEA,OAAOZ;AACT;AAQO,MAAML,sBAAsB,OAAOoB,IAAYC,OAAeC;IACnE,MAAMV,SAAS,MAAMN,kBAAOC,aAAagB,WAAW;QAClDf,OAAO;YACLgB,QAAQJ;QACV;QACAK,MAAM;YACJC,mBAAmBJ;YACnBZ,aAAaW;YACbM,eAAe,IAAIC;QACrB;IACF;IAEA,OAAOhB;AACT;AAOO,MAAMX,uBAAuB,OAAO4B;IACzC,MAAMjB,SAAS,MAAMN,kBAAOO,mBAAmBiB,OAAO;QACpDL,MAAMI;IACR;IAEA,OAAOjB;AACT;AAOO,MAAMV,yBAAyB,OAAOkB;IAC3C,MAAMR,SAAS,MAAMN,kBAAOO,mBAAmBU,WAAW;QACxDf,OAAO;YACLO,cAAcK;QAChB;QACAK,MAAM;YACJV,cAAc;QAChB;IACF;IAEA,OAAOH;AACT;AAEO,MAAMT,2CAA2C,OAAOiB;IAC7D,MAAMR,SAAS,MAAMN,kBAAOO,mBAAmBC,SAAS;QACtDN,OAAO;YACLO,cAAcK;QAChB;IACF;IAEA,OAAOR,mBAAAA,oBAAAA,KAAAA,IAAAA,OAAQmB;AACjB"}