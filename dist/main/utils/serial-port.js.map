{"version":3,"sources":["../../../src/main/utils/serial-port.ts"],"sourcesContent":["import { SerialPort as SerialPortLib } from 'serialport'\n\nexport default class SerialPort {\n  private portInstance: null | SerialPortLib = null\n  private data = ''\n\n  constructor({ path, baudRate = 115200 }: { path: string; baudRate?: number }) {\n    this.init({ path, baudRate })\n    this.addDataListener()\n  }\n\n  private init({ path, baudRate = 115200 }: { path: string; baudRate?: number }) {\n    if (this.portInstance)\n      return\n\n    this.portInstance = new SerialPortLib({ path, baudRate, autoOpen: false, dataBits: 8, stopBits: 1, parity: 'none' })\n  }\n\n  async open() {\n    return new Promise<void>((resolve, reject) => {\n      this.portInstance.open((error) => {\n        if (error)\n          reject(error)\n        else resolve()\n      })\n    })\n  }\n\n  // 关闭串口\n  close() {\n    if (!this.portInstance)\n      return\n\n    this.portInstance.close()\n    this.data = ''\n  }\n\n  // 写入数据\n  write(data) {\n    if (!this.portInstance)\n      return\n\n    this.portInstance.write(data)\n  }\n\n  getData() {\n    if (!this.portInstance)\n      return\n\n    return this.data\n  }\n\n  setData(source: string) {\n    if (!this.portInstance)\n      return\n\n    this.data = source\n  }\n\n  // 添加数据返回的监听器\n  addDataListener() {\n    if (!this.portInstance)\n      return\n\n    this.portInstance.on('open', () => {\n      console.log('串口打开成功')\n    })\n\n    this.portInstance.on('close', () => {\n      console.log('串口关闭')\n    })\n\n    this.portInstance.on('error', (error) => {\n      console.log('串口出错：', error)\n    })\n\n    this.portInstance.on('data', (data) => {\n      this.data += data.toString('hex')\n    })\n  }\n}\n"],"names":["SerialPort","path","baudRate","portInstance","data","init","addDataListener","SerialPortLib","autoOpen","dataBits","stopBits","parity","open","Promise","resolve","reject","error","close","write","getData","setData","source","on","console","log","toString"],"mappings":";;;;;;;eAEqBA;;;0BAFuB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE7B,IAAA,AAAMA,2BAAN;;aAAMA,WAIP,KAAgE;YAA9DC,OAAF,MAAEA,wBAAF,MAAQC,UAAAA,wCAAW;gCAJZF;QACnB,uBAAQG,gBAAqC;QAC7C,uBAAQC,QAAO;QAGb,IAAI,CAACC,KAAK;YAAEJ,MAAAA;YAAMC,UAAAA;QAAS;QAC3B,IAAI,CAACI;;kBANYN;;YASXK,KAAAA;mBAAR,SAAQA,KAAK,KAAgE;oBAA9DJ,OAAF,MAAEA,wBAAF,MAAQC,UAAAA,wCAAW;gBAC9B,IAAI,IAAI,CAACC,cACP;gBAEF,IAAI,CAACA,eAAe,IAAII,uBAAc;oBAAEN,MAAAA;oBAAMC,UAAAA;oBAAUM,UAAU;oBAAOC,UAAU;oBAAGC,UAAU;oBAAGC,QAAQ;gBAAO;YACpH;;;YAEMC,KAAAA;mBAAN,SAAMA;;uBAAN,oBAAA;;wBACE;;4BAAO,IAAIC,QAAc,SAACC,SAASC;gCACjC,MAAKZ,aAAaS,KAAK,SAACI;oCACtB,IAAIA,OACFD,OAAOC;yCACJF;gCACP;4BACF;;;gBACF;;;;YAEA,OAAO;YACPG,KAAAA;mBAAAA,SAAAA;gBACE,IAAI,CAAC,IAAI,CAACd,cACR;gBAEF,IAAI,CAACA,aAAac;gBAClB,IAAI,CAACb,OAAO;YACd;;;YAEA,OAAO;YACPc,KAAAA;mBAAAA,SAAAA,MAAMd,IAAI;gBACR,IAAI,CAAC,IAAI,CAACD,cACR;gBAEF,IAAI,CAACA,aAAae,MAAMd;YAC1B;;;YAEAe,KAAAA;mBAAAA,SAAAA;gBACE,IAAI,CAAC,IAAI,CAAChB,cACR;gBAEF,OAAO,IAAI,CAACC;YACd;;;YAEAgB,KAAAA;mBAAAA,SAAAA,QAAQC,MAAc;gBACpB,IAAI,CAAC,IAAI,CAAClB,cACR;gBAEF,IAAI,CAACC,OAAOiB;YACd;;;YAEA,aAAa;YACbf,KAAAA;mBAAAA,SAAAA;;gBACE,IAAI,CAAC,IAAI,CAACH,cACR;gBAEF,IAAI,CAACA,aAAamB,GAAG,QAAQ;oBAC3BC,QAAQC,IAAI;gBACd;gBAEA,IAAI,CAACrB,aAAamB,GAAG,SAAS;oBAC5BC,QAAQC,IAAI;gBACd;gBAEA,IAAI,CAACrB,aAAamB,GAAG,SAAS,SAACN;oBAC7BO,QAAQC,IAAI,SAASR;gBACvB;gBAEA,IAAI,CAACb,aAAamB,GAAG,QAAQ,SAAClB;oBAC5B,MAAKA,QAAQA,KAAKqB,SAAS;gBAC7B;YACF;;;WA7EmBzB"}