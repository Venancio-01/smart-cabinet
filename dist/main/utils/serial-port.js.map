{"version":3,"sources":["../../../src/main/utils/serial-port.ts"],"sourcesContent":["import { SerialPort as SerialPortLib } from 'serialport'\n\nexport default class SerialPort {\n  private portInstance: null | SerialPortLib = null\n  private data = ''\n\n  constructor({ path, baudRate = 115200 }: { path: string; baudRate?: number }) {\n    this.init({ path, baudRate })\n    this.addDataListener()\n  }\n\n  private init({ path, baudRate = 115200 }: { path: string; baudRate?: number }) {\n    if (this.portInstance) return\n\n    this.portInstance = new SerialPortLib({ path, baudRate, autoOpen: false, dataBits: 8, stopBits: 1, parity: 'none' })\n  }\n\n  async open() {\n    return new Promise<void>((resolve, reject) => {\n      this.portInstance.open(error => {\n        if (error) reject(error)\n        else resolve()\n      })\n    })\n  }\n\n  // 关闭串口\n  close() {\n    if (!this.portInstance) return\n\n    this.portInstance.close()\n    this.data = ''\n  }\n\n  // 写入数据\n  write(data) {\n    if (!this.portInstance) return\n\n    this.portInstance.write(data)\n  }\n\n  getData() {\n    if (!this.portInstance) return\n\n    return this.data\n  }\n\n  setData(source: string) {\n    if (!this.portInstance) return\n\n    this.data = source\n  }\n\n  // 添加数据返回的监听器\n  addDataListener() {\n    if (!this.portInstance) return\n\n    this.portInstance.on('open', () => {\n      console.log('串口打开成功')\n    })\n\n    this.portInstance.on('close', () => {\n      console.log('串口关闭')\n    })\n\n    this.portInstance.on('error', error => {\n      console.log('串口出错：', error)\n    })\n\n    this.portInstance.on('data', data => {\n      this.data += data.toString('hex')\n    })\n  }\n}\n"],"names":["SerialPort","init","path","baudRate","portInstance","SerialPortLib","autoOpen","dataBits","stopBits","parity","open","Promise","resolve","reject","error","close","data","write","getData","setData","source","addDataListener","on","console","log","toString","constructor"],"mappings":";;;;;;;eAEqBA;;;4BAFuB;;;;;;;;;;;;;;AAE7B,MAAMA;IASXC,KAAK,EAAEC,KAAI,EAAEC,UAAW,OAAM,EAAuC,EAAE;QAC7E,IAAI,IAAI,CAACC,cAAc;QAEvB,IAAI,CAACA,eAAe,IAAIC,uBAAc;YAAEH;YAAMC;YAAUG,UAAU;YAAOC,UAAU;YAAGC,UAAU;YAAGC,QAAQ;QAAO;IACpH;IAEA,MAAMC,OAAO;QACX,OAAO,IAAIC,QAAc,CAACC,SAASC;YACjC,IAAI,CAACT,aAAaM,KAAKI,CAAAA;gBACrB,IAAIA,OAAOD,OAAOC;qBACbF;YACP;QACF;IACF;IAEA,OAAO;IACPG,QAAQ;QACN,IAAI,CAAC,IAAI,CAACX,cAAc;QAExB,IAAI,CAACA,aAAaW;QAClB,IAAI,CAACC,OAAO;IACd;IAEA,OAAO;IACPC,MAAMD,IAAI,EAAE;QACV,IAAI,CAAC,IAAI,CAACZ,cAAc;QAExB,IAAI,CAACA,aAAaa,MAAMD;IAC1B;IAEAE,UAAU;QACR,IAAI,CAAC,IAAI,CAACd,cAAc;QAExB,OAAO,IAAI,CAACY;IACd;IAEAG,QAAQC,MAAc,EAAE;QACtB,IAAI,CAAC,IAAI,CAAChB,cAAc;QAExB,IAAI,CAACY,OAAOI;IACd;IAEA,aAAa;IACbC,kBAAkB;QAChB,IAAI,CAAC,IAAI,CAACjB,cAAc;QAExB,IAAI,CAACA,aAAakB,GAAG,QAAQ;YAC3BC,QAAQC,IAAI;QACd;QAEA,IAAI,CAACpB,aAAakB,GAAG,SAAS;YAC5BC,QAAQC,IAAI;QACd;QAEA,IAAI,CAACpB,aAAakB,GAAG,SAASR,CAAAA;YAC5BS,QAAQC,IAAI,SAASV;QACvB;QAEA,IAAI,CAACV,aAAakB,GAAG,QAAQN,CAAAA;YAC3B,IAAI,CAACA,QAAQA,KAAKS,SAAS;QAC7B;IACF;IAlEAC,YAAY,EAAExB,KAAI,EAAEC,UAAW,OAAM,EAAuC,CAAE;QAH9E,uBAAQC,gBAAqC;QAC7C,uBAAQY,QAAO;QAGb,IAAI,CAACf,KAAK;YAAEC;YAAMC;QAAS;QAC3B,IAAI,CAACkB;IACP;AAgEF"}