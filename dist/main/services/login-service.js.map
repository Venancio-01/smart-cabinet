{"version":3,"sources":["../../../src/main/services/login-service.ts"],"sourcesContent":["import { genMd5EncryptedPassword, genResponseData } from '@/utils'\nimport { queryUserByLoginName, queryUserByUserId } from '@/database/methods/user'\nimport prisma from '@/database'\n\nconst onPasswordLogin = async ({ username, password }: PasswordLoginProps) => {\n  const user = await queryUserByLoginName(username)\n  if (user === null) return genResponseData(false, '用户不存在')\n  const encryptedPassword = genMd5EncryptedPassword(username, password, user.salt)\n  if (user.password !== encryptedPassword) return genResponseData(false, '密码错误')\n  return genResponseData(true, '登录成功', user)\n}\n\nconst onCardLogin = async (cardNumber: string) => {\n  const result = await prisma.rfid_card_user.findFirst({\n    where: {\n      card_data: cardNumber\n    },\n    select: {\n      user_id: true\n    }\n  })\n  if (result === null) return genResponseData(false, '用户ID查找失败')\n\n  const userId = result?.user_id\n  const user = await queryUserByUserId(userId)\n  if (user === null) return genResponseData(false, '用户查找失败')\n\n  return genResponseData(true, '登录成功', user)\n}\n\nconst loginService = {\n  name: 'login' as const,\n  fns: {\n    onPasswordLogin,\n    onCardLogin\n  }\n}\n\nexport default loginService\n\n"],"names":["onPasswordLogin","username","password","user","queryUserByLoginName","genResponseData","encryptedPassword","genMd5EncryptedPassword","salt","onCardLogin","cardNumber","result","prisma","rfid_card_user","findFirst","where","card_data","select","user_id","userId","queryUserByUserId","loginService","name","fns"],"mappings":";;;;+BAsCA;;;eAAA;;;uBAtCyD;sBACD;iEACrC;;;;;;AAEnB,MAAMA,kBAAkB,OAAO,EAAEC,SAAQ,EAAEC,SAAQ,EAAsB;IACvE,MAAMC,OAAO,MAAMC,IAAAA,4BAAqBH;IACxC,IAAIE,SAAS,MAAM,OAAOE,IAAAA,wBAAgB,OAAO;IACjD,MAAMC,oBAAoBC,IAAAA,gCAAwBN,UAAUC,UAAUC,KAAKK;IAC3E,IAAIL,KAAKD,aAAaI,mBAAmB,OAAOD,IAAAA,wBAAgB,OAAO;IACvE,OAAOA,IAAAA,wBAAgB,MAAM,QAAQF;AACvC;AAEA,MAAMM,cAAc,OAAOC;IACzB,MAAMC,SAAS,MAAMC,kBAAOC,eAAeC,UAAU;QACnDC,OAAO;YACLC,WAAWN;QACb;QACAO,QAAQ;YACNC,SAAS;QACX;IACF;IACA,IAAIP,WAAW,MAAM,OAAON,IAAAA,wBAAgB,OAAO;IAEnD,MAAMc,SAASR,mBAAAA,oBAAAA,KAAAA,IAAAA,OAAQO;IACvB,MAAMf,OAAO,MAAMiB,IAAAA,yBAAkBD;IACrC,IAAIhB,SAAS,MAAM,OAAOE,IAAAA,wBAAgB,OAAO;IAEjD,OAAOA,IAAAA,wBAAgB,MAAM,QAAQF;AACvC;AAEA,MAAMkB,eAAe;IACnBC,MAAM;IACNC,KAAK;QACHvB;QACAS;IACF;AACF;MAEA,WAAeY"}